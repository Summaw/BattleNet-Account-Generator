let plan=null,checking_server_plan=!1,rendering_server_plan=!1;async function check_plan(){var e=await BG.exec("get_settings");e&&!checking_server_plan&&(checking_server_plan=!0,(plan=await BG.exec("get_server_plan",{key:e.key})).error&&(plan={error:!0,plan:plan.message,credit:0,quota:0,duration:null,lastreset:null}),checking_server_plan=!1)}async function initialize_ui(){var e=await BG.exec("get_settings");async function t(e,t){var n=document.querySelector(`input#${e}[type="checkbox"]`);if(n){var a=n.dataset?.disables?.split(",");if(a)for(const i of a){var r=document.querySelector("#"+i);r.disabled=!t}n.checked=t,await BG.exec("set_settings",{id:e,value:t})}}async function n(e,t){var n=document.querySelector(`input#${e}[type="text"]`);if(n){try{t=t.trim()}catch{}if(n.classList.contains("number")){try{t=parseInt(t)}catch{t=0}999999<(t=(t=isNaN(t)?0:t)<0?0:t)&&(t=999999)}n.value=t,await BG.exec("set_settings",{id:e,value:t})}}async function a(e,t){var n=document.querySelector("select#"+e);n&&(n.value=t,await BG.exec("set_settings",{id:e,value:t}))}for(const i in e)try{await t(i,e[i]),await n(i,e[i]),await a(i,e[i])}catch{}for(const c of document.querySelectorAll('.settings_group input[type="checkbox"]'))c.addEventListener("change",()=>t(c.id,c.checked));for(const s of document.querySelectorAll('.settings_group input[type="text"]'))s.addEventListener("input",()=>n(s.id,s.value));for(const l of document.querySelectorAll(".settings_group select"))l.addEventListener("change",()=>a(l.id,l.value));document.querySelector("#manage").addEventListener("click",async()=>{await BG.exec("open_tab",{url:"https://nopecha.com/manage"})}),document.querySelector("#footer").addEventListener("click",async()=>{await BG.exec("open_tab",{url:"https://nopecha.com/discord"})});let r=null;document.querySelector("#key").addEventListener("input",()=>{clearTimeout(r),r=setTimeout(check_plan,500)});for(const d of document.querySelectorAll(".tab_btn")){d.dataset.target;d.addEventListener("click",()=>{for(const e of document.querySelectorAll(".tab"))e.classList.add("hidden");for(const t of document.querySelectorAll(".tab_btn"))t.classList.remove("active");d.classList.add("active"),document.querySelector(d.dataset.target).classList.remove("hidden")})}}async function render_plan(){var t=await BG.exec("get_settings");if(t&&plan&&!rendering_server_plan){rendering_server_plan=!0;var t=document.querySelector("#plan"),n=document.querySelector("#credit"),a=document.querySelector("#refills"),r=document.querySelector("#ipbanned_warning"),i=Date.now()/1e3;let e=null;plan.lastreset&&plan.duration&&(e=Math.floor(Math.max(0,plan.duration-(i-plan.lastreset)))),t.innerHTML=plan.plan,plan.error?(t.classList.remove("green"),t.classList.add("red")):(t.classList.remove("red"),t.classList.add("green")),"Banned IP"===plan.plan?r.classList.remove("hidden"):r.classList.add("hidden"),0===e?(n.classList.remove("green"),n.classList.remove("red"),n.innerHTML='<div class="loading"><div></div><div></div><div></div><div></div></div>'):(n.innerHTML=plan.credit+" / "+plan.quota,0===plan.credit?(n.classList.remove("green"),n.classList.add("red")):(n.classList.remove("red"),n.classList.add("green"))),e?(i=Time.seconds_as_hms(e),a.innerHTML=""+i):a.innerHTML='<div class="loading"><div></div><div></div><div></div><div></div></div>',0!==plan.duration&&0===e&&await check_plan(),rendering_server_plan=!1}}async function main(){await initialize_ui(),await check_plan(),await render_plan(),setInterval(render_plan,500)}document.addEventListener("DOMContentLoaded",main);
