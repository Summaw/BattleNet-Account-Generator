(async()=>{function c(){var e="true"===document.querySelector(".recaptcha-checkbox")?.getAttribute("aria-checked"),t=document.querySelector("#recaptcha-verify-button")?.disabled;return e||t}function d(a=15e3){return new Promise(async e=>{for(var t=Time.time();;){var c=document.querySelectorAll(".rc-imageselect-tile"),r=document.querySelectorAll(".rc-imageselect-dynamic-selected");if(0<c.length&&0===r.length)return e(!0);if(Time.time()-t>a)return e(!1);await Time.sleep(100)}})}let p=null;function y(e=100){return new Promise(m=>{let f=!1;const h=setInterval(async()=>{if(!f){f=!0;var r=document.querySelector(".rc-imageselect-instructions")?.innerText?.split("\n"),a=await async function(e){let t=null;return(t=1<e.length?(t=e.slice(0,2).join(" ")).replace(/\s+/g," ")?.trim():t.join("\n"))||null}(r);if(a){var r=3===r.length,i=document.querySelectorAll("table tr td");if(9===i.length||16===i.length){var l=[],n=Array(i.length).fill(null);let e=null,t=!1,c=0;for(const u of i){var o=u?.querySelector("img");if(!o)return void(f=!1);var s=o?.src?.trim();if(!s||""===s)return void(f=!1);300<=o.naturalWidth?e=s:100==o.naturalWidth&&(n[c]=s,t=!0),l.push(u),c++}t&&(e=null);i=JSON.stringify([e,n]);if(p!==i)return p=i,clearInterval(h),f=!1,m({task:a,is_hard:r,cells:l,background_url:e,urls:n})}}f=!1}},e)})}async function e(e){c()?(r=r||!0,e.debug&&await BG.exec("reset_recaptcha")):(r=!1,await Time.sleep(500),document.querySelector("#recaptcha-anchor")?.click())}async function t(r){r.debug&&await BG.exec("reload_tab",{delay:3e5,overwrite:!0});var a=await BG.exec("get_cache",{name:"recaptcha_visible",tab_specific:!0});if(!0===a&&!c())if(g=!(g||!function(){for(const e of[".rc-imageselect-incorrect-response"])if(""===document.querySelector(e)?.style.display)return 1}()||(v=[],0)),function(){for(const e of[".rc-imageselect-error-select-more",".rc-imageselect-error-dynamic-more",".rc-imageselect-error-select-something"])if(""===document.querySelector(e)?.style.display)return 1}())v=[],await BG.exec("reset_recaptcha");else if(await d()){var{task:a,is_hard:i,cells:t,background_url:l,urls:n}=await y(),o=9==t.length?3:4,s=[];let e,c=[];if(null===l){e="1x1";for(let e=0;e<n.length;e++){var u=n[e],m=t[e];u&&!v.includes(u)&&(s.push(u),c.push(m))}}else s.push(l),e=o+"x"+o,c=t;var l=Time.time(),f=(await NopeCHA.post({captcha_type:"recaptcha",task:a,image_urls:s,grid:e,key:r.key}))["data"];if(f){a=r.recaptcha_solve_delay-(Time.time()-l);0<a&&await Time.sleep(a);let t=0;for(let e=0;e<f.length;e++)!1!==f[e]&&(t++,function(e){try{return e.classList.contains("rc-imageselect-tileselected")}catch{}}(c[e])||c[e]?.click());for(const h of n)v.push(h),9<v.length&&v.shift();(3==o&&i&&0===t&&await d()||3==o&&!i||4==o)&&(await Time.sleep(200),document.querySelector("#recaptcha-verify-button")?.click())}}else await BG.exec("reset_recaptcha")}let r=!1,g=!1,v=[];for(;;){await Time.sleep(1e3);var a=await BG.exec("get_settings");a&&"image"===a.recaptcha_solve_method&&(!async function(){var t=document.querySelectorAll('iframe[src*="/bframe"]');if(0<t.length){let e=!1;for(const c of t)if(e="visible"===window.getComputedStyle(c).visibility)break;e?await BG.exec("set_cache",{name:"recaptcha_visible",value:!0,tab_specific:!0}):await BG.exec("set_cache",{name:"recaptcha_visible",value:!1,tab_specific:!0})}}(),a.recaptcha_auto_open&&null!==document.querySelector(".recaptcha-checkbox")?await e(a):a.recaptcha_auto_solve&&null!==document.querySelector("#rc-imageselect")&&await t(a))}})();
